<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transformation</title>
  </head>
  <style>
    .wrapper {
      display: block;
    }
  </style>
  <body onload="handlerOnload()">
    <div class="wrapper">
      <canvas
        bindtouchstart="handlerStart"
        bindtouchmove="handlerMove"
        id="canvas"
        width="300"
        height="300"
        >can not support canvas</canvas
      >
      <button onclick="handlerSave">Save</button>
      <button onclick="handlerRestore">Restore</button>
    </div>
    <div>
      <canvas id="canvas2" width="300" height="300"
        >can not support canvas</canvas
      >
    </div>
    <div>
      <canvas id="canvas-rotate" width="300" height="300"
        >can not support canvas</canvas
      >
      <button onclick="handlerTenAngle()">+10°</button>
    </div>
    <div style="display: flex; flex-direction: column; align-items: center">
      <canvas id="canvas-scale" width="300" height="300"
        >can not support canvas</canvas
      >
      <button onclick="scaleBig()">Scale Big</button>
      <button onclick="scaleSmall()">Scale Small</button>
    </div>
  </body>
  <script>
    var ctx;
    function handlerOnload() {
      ctx = document.getElementById("canvas").getContext("2d");

      ctx.fillRect(0, 0, 150, 150); // 使用默认设置绘制一个矩形
      // ctx.save(); // 保存默认状态

      ctx.fillStyle = "#09F"; // 在原有配置基础上对颜色做改变
      ctx.fillRect(15, 15, 120, 120); // 使用新的设置绘制一个矩形

      // ctx.save(); // 保存当前状态
      ctx.fillStyle = "#FFF"; // 再次改变颜色配置
      ctx.globalAlpha = 0.5;
      ctx.fillRect(30, 30, 90, 90); // 使用新的配置绘制一个矩形

      ctx.restore(); // 重新加载之前的颜色状态
      ctx.fillRect(45, 45, 60, 60); // 使用上一次的配置绘制一个矩形

      ctx.restore(); // 加载默认颜色配置
      ctx.fillRect(60, 60, 30, 30); // 使用加载的配置绘制一个矩形

      // window.addEventListener()

      setCanvas2();

      setRotateCavas();

      setScaleCavas();
    }
    function handlerStart(e) {
      console.log(e);
    }
    function handlerMove(e) {
      console.log("move = ", JSON.stringify(e));
    }
    function handlerSave() {
      ctx.save();
    }
    function handlerRestore() {
      ctx.restore();
    }
    // ranslate
    function setCanvas2() {
      const ctx2 = document.getElementById("canvas2").getContext("2d");
      for (var i = 0; i < 3; i++) {
        for (var j = 0; j < 3; j++) {
          ctx2.save();
          ctx2.fillStyle =
            "rgb(" +
            51 * i +
            ", " +
            (255 - 51 * i) +
            `, ${Math.random(0, 255)})`;
          ctx2.translate(10 + j * 50, 10 + i * 50);
          ctx2.fillRect(0, 0, 25, 25);
          ctx2.restore();
        }
      }
    }
    // rotate
    /**
     * rotate(angle)
     * 这个方法只接受一个参数：旋转的角度 (angle)，它是顺时针方向的，以弧度为单位的值。
     */
    var ctx_ro,
      angle = 0.0;
    function setRotateCavas() {
      ctx_ro = document.getElementById("canvas-rotate").getContext("2d");
      ctx_ro.save();

      ctx_ro.fillStyle = "#00ff00";
      ctx_ro.fillRect(10, 10, 150, 150);
      // ctx_ro.rotate((Math.PI / 180) * 20);
      ctx_ro.fillStyle = "#4D4E53";
      ctx_ro.fillRect(30, 30, 100, 100);
      ctx_ro.restore();
    }
    function handlerTenAngle() {
      ctx_ro.save();
      angle += 10;
      let de = (Math.PI / 180) * angle;
      console.log(angle, de);
      ctx_ro.rotate(de);
      ctx_ro.fillStyle = "#4D4E53";
      ctx_ro.fillRect(30, 30, 100, 100);
      ctx_ro.restore();
    }
    // scale
    var ctx_scale;
    function setScaleCavas() {
      ctx_scale = document.getElementById("canvas-scale").getContext("2d");
      // draw a simple rectangle, but scale it.
      ctx_scale.save();
      ctx_scale.scale(10, 3);
      ctx_scale.fillRect(1, 10, 10, 10);
      ctx_scale.restore();

      // mirror horizontally
      ctx_scale.scale(-1, 1);
      ctx_scale.font = "48px serif";
      ctx_scale.fillText("MDN", -135, 120);
    }
    function scaleBig() {
      console.log("big");
      ctx_scale.save();
      ctx_scale.scale(100, 100);

      ctx_scale.font = "48px serif";
      ctx_scale.fillText("MDN---", -135, 120);
      ctx_scale.restore();
    }
    function scaleSmall() {
      console.log("small");
    }
  </script>
</html>
